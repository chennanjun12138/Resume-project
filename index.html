<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI æ™ºèƒ½ç®€å†åˆ†æç³»ç»Ÿ</title>
  <style>
    :root { --primary: #2563eb; --bg: #f8fafc; --success: #22c55e; --warning: #f59e0b; --danger: #ef4444; }
    body { max-width: 900px; margin: 0 auto; padding: 40px 20px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: #334155; }
    h1 { text-align: center; color: #1e293b; margin-bottom: 40px; }
    
    .card { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; }
    h2 { font-size: 1.1rem; color: #64748b; margin-top: 0; margin-bottom: 15px; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }
    
    textarea { width: 100%; height: 120px; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; resize: vertical; box-sizing: border-box; font-family: inherit; }
    input[type="file"] { display: block; width: 100%; padding: 10px; background: #f1f5f9; border-radius: 6px; }
    
    .btn-analyze { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: background 0.2s; }
    .btn-analyze:hover { background: #1d4ed8; }
    .btn-analyze:disabled { background: #94a3b8; cursor: not-allowed; }

    #result-area { display: none; margin-top: 30px; border-top: 4px solid var(--primary); }
    
    /* æŠ¥å‘Šå¤´éƒ¨ */
    .report-header { display: flex; justify-content: space-between; align-items: flex-start; padding-bottom: 20px; border-bottom: 1px solid #e2e8f0; margin-bottom: 20px; }
    .candidate-name { font-size: 1.8rem; font-weight: bold; color: #1e293b; }
    .candidate-sub { color: #64748b; margin-top: 5px; }
    
    /* æ€»åˆ†å¾½ç«  */
    .score-badge { text-align: center; width: 90px; height: 90px; border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1); flex-shrink: 0; }
    .score-val { font-size: 2rem; line-height: 1; }
    .score-label { font-size: 0.7rem; opacity: 0.9; }

    /* ç»´åº¦è¯„åˆ†æ¡ */
    .score-breakdown { margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; background: #f8fafc; padding: 15px; border-radius: 8px; }
    .breakdown-item { display: flex; flex-direction: column; }
    .breakdown-label { font-size: 0.8rem; color: #64748b; margin-bottom: 5px; display: flex; justify-content: space-between; }
    .progress-bg { background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--primary); border-radius: 4px; width: 0; transition: width 1s ease-out; }

    /* å…³é”®è¯æ ‡ç­¾ */
    .keywords-box { margin-bottom: 20px; }
    .keyword-tag { display: inline-block; background: #e0f2fe; color: #0369a1; padding: 4px 10px; border-radius: 15px; font-size: 0.85rem; margin-right: 8px; margin-bottom: 8px; border: 1px solid #bae6fd; }

    /* ä¿¡æ¯ç½‘æ ¼ */
    .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
    .info-item { background: #f8fafc; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0; }
    .info-label { font-size: 0.8rem; color: #64748b; display: block; margin-bottom: 4px; }
    .info-text { font-weight: 600; color: #334155; word-break: break-all; }

    .section-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 12px; display: flex; align-items: center; color: #1e293b; }
    .section-title::before { content: ''; display: inline-block; width: 4px; height: 16px; background: var(--primary); margin-right: 8px; border-radius: 2px; }

    .edu-list { margin-bottom: 25px; padding-left: 0; list-style: none; }
    .edu-item { background: #fff; border-bottom: 1px dashed #e2e8f0; padding: 8px 0; color: #475569; }

    .summary-box { background: #eff6ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary); color: #1e40af; line-height: 1.6; margin-bottom: 25px; }
    
    .analysis-content { line-height: 1.7; color: #475569; white-space: pre-wrap; }
    .highlight-good { color: var(--success); font-weight: bold; background: #f0fdf4; padding: 2px 6px; border-radius: 4px; }
    .highlight-bad { color: var(--danger); font-weight: bold; background: #fef2f2; padding: 2px 6px; border-radius: 4px; }
    .cached-badge { display: inline-block; background: #e0f2fe; color: #0284c7; font-size: 0.75rem; padding: 2px 8px; border-radius: 10px; margin-left: 10px; vertical-align: middle; border: 1px solid #bae6fd; }

    .spinner { display: none; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>

<h1>ğŸš€ AI æ™ºèƒ½ç®€å†åˆ†æç³»ç»Ÿ</h1>

<div class="card">
  <h2>1. ä¸Šä¼ ç®€å† (PDF)</h2>
  <input type="file" id="file" accept="application/pdf" />
</div>

<div class="card">
  <h2>2. è¾“å…¥å²—ä½æè¿° (JD)</h2>
  <textarea id="jd" placeholder="è¯·ç²˜è´´å²—ä½ JDï¼Œä¾‹å¦‚ï¼š
1. ç†Ÿç»ƒæŒæ¡ Python/Java
2. æœ‰ 3 å¹´ä»¥ä¸Šåç«¯å¼€å‘ç»éªŒ..."></textarea>
</div>

<button class="btn-analyze" onclick="analyze()" id="btn">âœ¨ å¼€å§‹æ·±åº¦åˆ†æ</button>
<div class="spinner" id="spinner"></div>

<div id="result-area" class="card">
  <!-- ç»“æœå°†åœ¨æ­¤å¤„æ¸²æŸ“ -->
</div>

<script>
  // âš ï¸ è¯·ç¡®è®¤è¿™æ˜¯ä½ æœ€æ–°çš„å…¬ç½‘åœ°å€ (é€šå¸¸ä¸éœ€è¦å˜ï¼Œé™¤éä½ åˆ é™¤äº†å‡½æ•°é‡å»º)
  const API_URL = "https://resum-check-scsgutsccm.cn-hangzhou.fcapp.run/check/analyze";

  async function analyze() {
    const fileInput = document.getElementById("file");
    const jdInput = document.getElementById("jd");
    const resultArea = document.getElementById("result-area");
    const btn = document.getElementById("btn");
    const spinner = document.getElementById("spinner");

    if (!fileInput.files.length) { alert("è¯·å…ˆä¸Šä¼  PDF ç®€å†"); return; }
    if (!jdInput.value.trim()) { alert("è¯·è¾“å…¥å²—ä½ JD"); return; }

    btn.disabled = true;
    btn.textContent = "AI æ­£åœ¨æ·±åº¦æ€è€ƒä¸­...";
    spinner.style.display = "block";
    resultArea.style.display = "none";
    resultArea.innerHTML = "";

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);
    formData.append("jd", jdInput.value.trim());

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        body: formData
      });
      
      const data = await res.json();
      
      if(data.error) {
        throw new Error(data.error);
      }

      renderReport(data);
      resultArea.style.display = "block";

    } catch (err) {
      alert("åˆ†æå¤±è´¥ï¼š" + err.message);
      console.error(err);
      resultArea.innerHTML = `<p style="color:red; text-align:center;">âŒ ${err.message}</p>`;
      resultArea.style.display = "block";
    } finally {
      btn.disabled = false;
      btn.textContent = "âœ¨ å¼€å§‹æ·±åº¦åˆ†æ";
      spinner.style.display = "none";
    }
  }

  function renderReport(data) {
    const resultArea = document.getElementById("result-area");
    const basic = data.basic_info || {};
    const score = data.match_score || 0;
    const breakdown = data.score_breakdown || {};
    const jdMeta = data.jd_analysis || {};
    
    // ç¼“å­˜æ ‡è®°
    const cacheTag = data._is_cached ? '<span class="cached-badge">âš¡ï¸ æé€Ÿç¼“å­˜å‘½ä¸­</span>' : '';

    // åˆ†æ•°é¢œè‰²é€»è¾‘
    let scoreColor = '#ef4444';
    if(score >= 80) scoreColor = '#22c55e';
    else if(score >= 60) scoreColor = '#f59e0b';

    // ç”Ÿæˆå…³é”®è¯æ ‡ç­¾
    let keywordsHtml = '';
    if(jdMeta.keywords && jdMeta.keywords.length) {
        keywordsHtml = `<div class="keywords-box">` + 
            jdMeta.keywords.map(k => `<span class="keyword-tag">#${k}</span>`).join('') + 
            `</div>`;
    }

    // ç”Ÿæˆç»´åº¦è¯„åˆ†æ¡ HTML (å®‰å…¨è·å–ï¼Œé»˜è®¤ä¸º 0)
    const renderBar = (label, val) => `
        <div class="breakdown-item">
            <div class="breakdown-label"><span>${label}</span><span>${val || 0}åˆ†</span></div>
            <div class="progress-bg"><div class="progress-fill" style="width: ${val || 0}%; background-color: ${val>=80?'#22c55e':(val>=60?'#f59e0b':'#ef4444')}"></div></div>
        </div>
    `;

    // æ ¼å¼åŒ–åˆ†ææ–‡æœ¬
    let analysisHtml = (data.match_analysis || "æ— è¯¦ç»†åˆ†æ")
        .replace(/\n/g, '<br/>')
        .replace(/(æ ¸å¿ƒä¼˜åŠ¿ï¼š)/g, '<br/><span class="highlight-good">âœ… $1</span>')
        .replace(/(å·®è·åˆ†æï¼š)/g, '<br/><span class="highlight-bad">âš ï¸ $1</span>')
        .replace(/(ç»¼åˆå»ºè®®ï¼š)/g, '<br/><span style="color:#2563eb;font-weight:bold">ğŸ’¡ $1</span>');

    // å­¦å†åˆ—è¡¨
    let eduHtml = '';
    if (data.education_background && data.education_background.length > 0) {
        eduHtml = `<div class="section-title">ğŸ“ å­¦å†èƒŒæ™¯</div><ul class="edu-list">` + 
            data.education_background.map(item => `<li class="edu-item">${item}</li>`).join('') + 
            `</ul>`;
    }

    const html = `
      <div class="report-header">
        <div style="flex:1">
          <div class="candidate-name">${basic.name || 'å€™é€‰äºº'} ${cacheTag}</div>
          
          <!-- ç»´åº¦è¯„åˆ†å±•ç¤ºåŒº -->
          <div class="score-breakdown">
             ${renderBar('ğŸ›  æŠ€èƒ½åŒ¹é… (40%)', breakdown.skill_score)}
             ${renderBar('ğŸ“ˆ ç»éªŒåŒ¹é… (30%)', breakdown.experience_score)}
             ${renderBar('ğŸ“ å­¦å†åŸºç¡€ (20%)', breakdown.education_score)}
             ${renderBar('ğŸŒŸ ç»¼åˆç´ è´¨ (10%)', breakdown.general_score)}
          </div>
        </div>
        
        <div style="margin-left: 20px; text-align: center;">
            <div class="score-badge" style="background-color: ${scoreColor}">
            <span class="score-val">${score}</span>
            <span class="score-label">ç»¼åˆåŒ¹é…åº¦</span>
            </div>
        </div>
      </div>

      <div class="section-title">ğŸ”‘ å²—ä½æ ¸å¿ƒå…³é”®è¯</div>
      ${keywordsHtml || '<p style="color:#94a3b8;font-size:0.9rem">æœªæå–åˆ°å…³é”®è¯</p>'}

      <div class="section-title">ğŸ“‹ åŸºæœ¬ä¿¡æ¯</div>
      <div class="info-grid">
        <div class="info-item"><span class="info-label">ğŸ“§ é‚®ç®±</span><div class="info-text">${basic.email || '-'}</div></div>
        <div class="info-item"><span class="info-label">ğŸ“± è”ç³»ç”µè¯</span><div class="info-text">${basic.phone || '-'}</div></div>
        <div class="info-item"><span class="info-label">ğŸ“ å­¦å†</span><div class="info-text">${basic.education || '-'}</div></div>
        <div class="info-item"><span class="info-label">ğŸ“ åœ°å€</span><div class="info-text">${basic.address || '-'}</div></div>
        <div class="info-item"><span class="info-label">ğŸ¯ æ±‚èŒæ„å‘</span><div class="info-text">${basic.job_intention || '-'}</div></div>
        <div class="info-item"><span class="info-label">â³ å·¥ä½œå¹´é™</span><div class="info-text">${basic.years_of_experience || '-'}</div></div>
      </div>

      ${eduHtml}

      <div class="section-title">ğŸ“ ç»¼åˆè¯„ä»·</div>
      <div class="summary-box">
        ${data.summary || 'æš‚æ— æ€»ç»“'}
      </div>

      <div class="section-title">ğŸ” æ·±åº¦åˆ†ææŠ¥å‘Š</div>
      <div class="analysis-content">
        ${analysisHtml}
      </div>
    `;

    resultArea.innerHTML = html;
  }
</script>

</body>
</html>